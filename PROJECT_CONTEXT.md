# Project Context: Legal Lease RAG & Insights Engine

## 1. High-Level Objective
Build a production-ready **RAG (Retrieval Augmented Generation)** system for **100+ Commercial Real Estate Leases**. The system must support:
1.  **Specific Q&A:** "What is the holdover rate for Starbucks?"
2.  **Clause Comparison:** "Compare the assignment clause in Lease A vs. Lease B."
3.  **Portfolio Insights:** "What is the total base rent across all properties?" (Structured Data Analysis).

## 2. Core Constraints & Rules
* **Cost:** STRICT **Free Tier** usage for development.
* **Privacy:** No data sent to OpenAI or Cohere.
* **Accuracy:** Must prevent "Semantic Drift" (confusing distinct legal terms).
* **Scale:** System must handle ~25k words per document without truncation.

## 3. Technology Stack (The "Free Tier" Stack)
| Component | Technology | Configuration / Version |
| :--- | :--- | :--- |
| **LLM** | **Google Gemini 2.5 Flash** | `model="gemini-2.5-flash"` (Via Google AI Studio) |
| **Embeddings** | **Google Gemini** | `model="models/text-embedding-004"` |
| **Vector DB** | **Pinecone (Serverless)** | Dims: **768**, Metric: `cosine`, Cloud: `AWS/us-east-1` |
| **Reranker** | **FlashRank** | Local Python Lib (`ms-marco-TinyBERT-L-2-v2`) |
| **Parser** | **LlamaParse** | Mode: `premium_mode=True` (Markdown output) |
| **Orchestration** | **LangChain** | Community + Google GenAI packages |

## 4. Architecture Overview
The system uses a **Dual-Path Ingestion** strategy:

### Path A: The "Read" Path (Vector Search)
1.  **Parse:** PDF $\rightarrow$ Markdown (LlamaParse) to preserve headers.
2.  **Chunk:** Context-Aware Chunking (split by `# Article` / `## Section`).
3.  **Enrich:** Every chunk is prepended with a "Sticky Note" summary generated by Gemini (e.g., *"This is the Rent Clause for Starbucks..."*).
4.  **Index:** Store in Pinecone with Metadata (`tenant_name`, `lease_id`).

### Path B: The "Insight" Path (Structured Data)
1.  **Extract:** Raw Text $\rightarrow$ Gemini 2.5 Flash (JSON Mode) $\rightarrow$ Pydantic Schema.
2.  **Schema:** Extracts `Rent`, `Dates`, `Parties`, `Renewal_Option`.
3.  **Store:** Saved to `data/metadata_store.json` for aggregation queries (Sum/Avg).
